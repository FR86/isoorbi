---
title: "Dual Inlet"
description: >
  A minimal example for processing .isox data from a dual inlet experiments
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Dual Inlet}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
library(isoorbi) #load isoorbi R package

#load a test file (dual inlet)

#create file path to dual inlet test file in isoorbi R package
file_path <-system.file("extdata", "testfile_DualInlet.isox", package = "isoorbi")

```

A basic data processing example
```{r, message=FALSE, results='hide'}

# Read .isox test data
df <- orbi_read_isox(file = file_path)

# Keep only most important columns; equivalent to simplify check box in IsoX
df.simple <- orbi_simplify_isox(dataset = df)

# Filter the data
df.filtered <- df.simple %>% orbi_filter_isox(
                              time_min = 0,
                              time_max = 70,
                              compounds = "NO3-",
                              isotopocules = c("15N", "18O", "17O")
                            )

# Clean the data by removing noise and outliers
df.clean <- df.filtered %>% orbi_filter_satellite_peaks() %>%
                            orbi_filter_weak_isotopocules(min_percent = 10) %>%
                            orbi_filter_scan_intensity(outlier_percent = 10)


### needs a new functionality here to process dual inlet data ####
# load functions from definitions below!!!

# define annotation table
df.annotation <- orbi_dualInlet_define(
                      reference = "ref",
                      sample = "smp",
                      number.of.blocks = 7,
                      switch.time = 0,
                      block.time = 10,
                      startup.time = 0,#usually 0, time before data run starts
                      segments = 1 #should segmenting data be a separate small function?
                  ) 

# annotate dual inlet data
df.annotated <- orbi_dualInlet_annotate(data = df.clean,
                                        annotations = df.annotation)


# Define base peak and calculate the results table
df.results <-
  df.annotated  %>% orbi_define_basepeak(basepeak_def = "15N") %>%
  orbi_summarize_results(ratio_method = "sum")
```


